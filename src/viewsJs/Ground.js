import * as THREE from 'three';
import * as CANNON from 'cannon-es';
import {PWorld, PShere, PJumpSphere, PPolyhedron, PBox } from '../PWorld/PObjects.js'
import { getDiceCubeMaterial, getEarthMaterial, getMeshWireMaterial } from '../PWorld/Scene/MeshMaterials.js'
import { BoxComposer } from '../PWorld/Tools/Composer.js';
import { rand } from 'three/tsl';


const world = new PWorld({
    cameraPosition: [100, 20, 20],
    gravity: [0, -100, 0],
    useGround: true,
    groundSize: [220, 220],
    useWorldRadius: true,    
    worldRadius: 200,
    orbitControlDistance: [1, 2000]
});

const boxComposer = new BoxComposer({
    // position: [0, 2.5, 0],
    color: 0x0000ff,
    // itemMass: 200,
    data: [[[2, 15, 1], [31.195980443318312, 7.5, 43.66900453145846], [0, -0.17902717047770075, 0, 0.9838441300484281]], [[2, 15, 1], [29.386267368035558, 7.5, 49.0202362008009], [0, -0.1513189958064657, 0, 0.988484982945175]], [[2, 15, 1], [27.81122361426832, 7.5, 54.465323201454844], [0, -0.135058610438715, 0, 0.9908376111888181]], [[2, 15, 1], [26.399325141819396, 7.5, 59.77329580964681], [0, -0.13468673773634135, 0, 0.9908882291550052]], [[2, 15, 1], [24.967491699946333, 7.5, 64.73270137860351], [0, -0.1625549552612276, 0, 0.9866994914967882]], [[2, 15, 1], [23.252386943072093, 7.5, 69.06494228806524], [0, -0.23614161138250261, 0, 0.9717186523750972]], [[2, 15, 1], [21.014172804659786, 7.5, 72.3862641848383], [0, -0.3784503402676091, 0, 0.9256215965238338]], [[2, 15, 1], [18.157654132482286, 7.5, 74.25382509740271], [0, -0.5947387100564384, 0, 0.8039190672949632]], [[2, 15, 1], [14.80617878824734, 7.5, 74.28565845276206], [-0, -0.797782223867877, 0, 0.6029457050849809]], [[2, 15, 1], [11.286175767366403, 7.5, 72.30451121347211], [-0, -0.9090594803379703, 0, 0.4166663667824171]], [[2, 15, 1], [8.022887826539584, 7.5, 68.44051198254719], [-0, -0.9593907599978921, 0, 0.28208043113741005]], [[2, 15, 1], [5.38965639620704, 7.5, 63.14396039353654], [-0, -0.9825850501504996, 0, 0.18581339892682336]], [[2, 15, 1], [3.5741571491350292, 7.5, 57.09866497168604], [-0, -0.9931838884166972, 0, 0.11655798466638374]], [[2, 15, 1], [2.51590345238291, 7.5, 51.06904737645812], [-0, -0.9974347320189599, 0, 0.07158180887812876]], [[2, 15, 1], [1.935440687857637, 7.5, 45.74037133056015], [-0, -0.9983795026292592, 0, 0.0569066668305936]], [[2, 15, 1], [1.433986206341276, 7.5, 41.60921843101915], [-0, -0.9953757701090955, 0, 0.09605767163391865]], [[2, 15, 1], [0.6131099569263079, 7.5, 38.953000694503764], [-0, -0.9629772888805446, 0, 0.26958253114821235]], [[2, 15, 1], [-0.8389700024472199, 7.5, 37.86775209795661], [-0, -0.7628021780490611, 0, 0.6466319178354935]], [[2, 15, 1], [-3.1243476344844656, 7.5, 38.33267902676507], [0, -0.5494861549163281, 0, 0.8355028219912062]], [[2, 15, 1], [-6.368201995185416, 7.5, 40.253188265469866], [0, -0.4681477310454028, 0, 0.8836502146873735]], [[2, 15, 1], [-10.668517512948315, 7.5, 43.4542542950363], [0, -0.4451981824110477, 0, 0.8954320624022235]], [[2, 15, 1], [-16.115026034582993, 7.5, 47.63213358221678], [0, -0.4522030432589578, 0, 0.8919150226716316]], [[2, 15, 1], [-22.748612488783692, 7.5, 52.305188441184924], [0, -0.48015714299470535, 0, 0.8771824884430617]], [[2, 15, 1], [-30.47014244018817, 7.5, 56.815673918641984], [0, -0.5254659658849846, 0, 0.8508146206410421]], [[2, 15, 1], [-38.944819390028044, 7.5, 60.415915429579755], [0, -0.5864716869864685, 0, 0.8099697280536142]], [[2, 15, 1], [-47.564513934529664, 7.5, 62.43137192926424], [0, -0.662657549100558, 0, 0.7489225411349572]], [[2, 15, 1], [-55.51497367544636, 7.5, 62.44879014935692], [-0, -0.7537446136436605, 0, 0.65716745004844]], [[2, 15, 1], [-61.95163244417565, 7.5, 60.45249879499364], [-0, -0.8554309456183216, 0, 0.5179168825965651]], [[2, 15, 1], [-66.23528627566817, 7.5, 56.84083092946401], [-0, -0.9477677650943098, 0, 0.3189612256186274]], [[2, 15, 1], [-68.14178502515837, 7.5, 52.29734242098768], [-0, -0.9958024454260127, 0, 0.09152862767229074]], [[2, 15, 1], [-67.95750929484426, 7.5, 47.55135934811097], [-0, 0.9956582892168186, 0, 0.09308367802056954]], [[2, 15, 1], [-66.40944324486432, 7.5, 43.11342834569675], [-0, 0.9806811427234522, 0, 0.19561312917752746]], [[2, 15, 1], [-64.44193005246277, 7.5, 39.0895285653188], [-0, 0.9786962029190605, 0, 0.2053137657143641]], [[2, 15, 1], [-62.9156467518034, 7.5, 35.152727548673546], [-0, 0.9924938599015061, 0, 0.12229447271977942]], [[2, 15, 1], [-62.34016204822065, 7.5, 30.690456434007118], [-0, 0.9999631311243854, 0, 0.008586989693153241]], [[2, 15, 1], [-62.74253564219966, 7.5, 25.073994004221724], [-0, -0.9985416319478232, 0, 0.05398712130691331]], [[2, 15, 1], [-63.72246250079529, 7.5, 17.944362860384217], [-0, -0.9981295903293097, 0, 0.06113363157091368]], [[2, 15, 1], [-64.6699192874958, 7.5, 9.398809579848521], [-0, -0.9993132791914262, 0, 0.03705361023885198]], [[2, 15, 1], [-65.05501525959016, 7.5, -2.1704746700350676E-14], [0, -1, 0, 6.123233995736766E-17]], [[2, 15, 1], [-64.6699192874958, 7.5, -9.398809579848562], [-0, 0.9993132791914263, 0, 0.03705361023885198]], [[2, 15, 1], [-63.72246250079529, 7.5, -17.94436286038426], [-0, 0.9981295903293174, 0, 0.06113363157091323]], [[2, 15, 1], [-62.74253564219966, 7.5, -25.073994004221756], [-0, 0.9985416319478135, 0, 0.05398712130691383]], [[2, 15, 1], [-62.34016204822065, 7.5, -30.690456434007157], [-0, -0.9999631311243861, 0, 0.008586989693153241]], [[2, 15, 1], [-62.9156467518034, 7.5, -35.152727548673575], [-0, -0.9924938599015067, 0, 0.12229447271977986]], [[2, 15, 1], [-64.44193005246278, 7.5, -39.089528565318844], [-0, -0.9786962029190607, 0, 0.2053137657143656]], [[2, 15, 1], [-66.40944324486435, 7.5, -43.11342834569678], [-0, -0.9806811427234512, 0, 0.19561312917752943]], [[2, 15, 1], [-67.9575092948443, 7.5, -47.551359348111006], [-0, -0.9956582892168196, 0, 0.09308367802056954]], [[2, 15, 1], [-68.1417850251584, 7.5, -52.297342420987704], [-0, 0.9958024454260085, 0, 0.09152862767229407]], [[2, 15, 1], [-66.23528627566816, 7.5, -56.84083092946403], [-0, 0.9477677650943092, 0, 0.31896122561863]], [[2, 15, 1], [-61.95163244417563, 7.5, -60.45249879499364], [-0, 0.8554309456183209, 0, 0.517916882596566]], [[2, 15, 1], [-55.51497367544634, 7.5, -62.44879014935692], [-0, 0.7537446136436605, 0, 0.65716745004844]], [[2, 15, 1], [-47.56451393452964, 7.5, -62.43137192926424], [0, 0.662657549100558, 0, 0.7489225411349572]], [[2, 15, 1], [-38.944819390028044, 7.5, -60.415915429579755], [0, 0.5864716869864686, 0, 0.8099697280536142]], [[2, 15, 1], [-30.470142440188177, 7.5, -56.815673918642], [0, 0.5254659658849848, 0, 0.8508146206410419]], [[2, 15, 1], [-22.7486124887837, 7.5, -52.30518844118494], [0, 0.4801571429947053, 0, 0.8771824884430617]], [[2, 15, 1], [-16.115026034583007, 7.5, -47.63213358221679], [0, 0.45220304325895744, 0, 0.8919150226716318]], [[2, 15, 1], [-10.668517512948336, 7.5, -43.45425429503631], [0, 0.4451981824110471, 0, 0.8954320624022238]], [[2, 15, 1], [-6.368201995185438, 7.5, -40.253188265469866], [0, 0.4681477310454027, 0, 0.8836502146873736]], [[2, 15, 1], [-3.124347634484484, 7.5, -38.33267902676507], [0, 0.5494861549163284, 0, 0.835502821991206]], [[2, 15, 1], [-0.8389700024472343, 7.5, -37.86775209795661], [-0, 0.7628021780490623, 0, 0.6466319178354925]], [[2, 15, 1], [0.6131099569262991, 7.5, -38.95300069450378], [-0, 0.9629772888805437, 0, 0.2695825311482132]], [[2, 15, 1], [1.433986206341272, 7.5, -41.60921843101916], [-0, 0.9953757701090924, 0, 0.09605767163391953]], [[2, 15, 1], [1.9354406878576365, 7.5, -45.740371330560166], [-0, 0.9983795026292389, 0, 0.05690666683059506]], [[2, 15, 1], [2.5159034523829122, 7.5, -51.06904737645813], [-0, 0.9974347320189623, 0, 0.07158180887812876]], [[2, 15, 1], [3.574157149135033, 7.5, -57.098664971686055], [-0, 0.9931838884166968, 0, 0.11655798466638374]], [[2, 15, 1], [5.389656396207043, 7.5, -63.14396039353656], [-0, 0.9825850501504998, 0, 0.1858133989268232]], [[2, 15, 1], [8.02288782653959, 7.5, -68.4405119825472], [-0, 0.9593907599978918, 0, 0.28208043113741044]], [[2, 15, 1], [11.286175767366409, 7.5, -72.30451121347213], [-0, 0.9090594803379698, 0, 0.4166663667824177]], [[2, 15, 1], [14.806178788247347, 7.5, -74.28565845276208], [-0, 0.7977822238678769, 0, 0.602945705084981]], [[2, 15, 1], [18.157654132482296, 7.5, -74.25382509740271], [0, 0.5947387100564379, 0, 0.8039190672949637]], [[2, 15, 1], [21.014172804659797, 7.5, -72.3862641848383], [0, 0.37845034026760777, 0, 0.9256215965238344]], [[2, 15, 1], [23.252386943072107, 7.5, -69.06494228806521], [0, 0.23614161138250203, 0, 0.9717186523750975]], [[2, 15, 1], [24.967491699946347, 7.5, -64.73270137860348], [0, 0.1625549552612273, 0, 0.9866994914967882]], [[2, 15, 1], [26.399325141819407, 7.5, -59.773295809646775], [0, 0.13468673773634096, 0, 0.9908882291550052]], [[2, 15, 1], [27.811223614268325, 7.5, -54.46532320145481], [0, 0.13505861043871464, 0, 0.9908376111888181]], [[2, 15, 1], [29.386267368035558, 7.5, -49.02023620080088], [0, 0.15131899580646563, 0, 0.988484982945175]], [[2, 15, 1], [31.195980443318312, 7.5, -43.66900453145844], [0, 0.17902717047770053, 0, 0.9838441300484281]], [[2, 15, 1], [33.258246291775684, 7.5, -38.73328891562963], [0, 0.22680471538817987, 0, 0.9739402553943886]], [[2, 15, 1], [35.65185526427956, 7.5, -34.62066764737222], [0, 0.3205477719360418, 0, 0.9472323505385779]], [[2, 15, 1], [38.61884499335278, 7.5, -31.71991550329435], [0, 0.4818961787483085, 0, 0.8762283223611175]], [[2, 15, 1], [42.581889613499015, 7.5, -30.22589527160674], [0, 0.63923581122156, 0, 0.7690107786318173]], [[2, 15, 1], [48.03730810240581, 7.5, -29.969157347776786], [-0, 0.7102524528868945, 0, 0.7039470528158703]], [[2, 15, 1], [55.34211023487835, 7.5, -30.33968387807245], [-0, 0.7156166443444856, 0, 0.6984932485981079]], [[2, 15, 1], [64.47056059778924, 7.5, -30.367194803157066], [0, 0.6817095134448937, 0, 0.7316229488464165]], [[2, 15, 1], [74.84510059340941, 7.5, -28.96042327117836], [0, 0.616960641752295, 0, 0.7869940066662491]], [[2, 15, 1], [85.33191384011481, 7.5, -25.238925478096096], [0, 0.5201626656263773, 0, 0.854067211224305]], [[2, 15, 1], [94.43542233909123, 7.5, -18.843183003536986], [0, 0.3854609733478216, 0, 0.9227241397220244]], [[2, 15, 1], [100.6495875694853, 7.5, -10.104470257936503], [0, 0.20863176208185194, 0, 0.9779942678004926]], [[2, 15, 1], [102.8582149748416, 7.5, 3.363452173691526E-14], [0, -1.0987444133977576E-15, 0, 1]], [[2, 15, 1], [100.64958756948525, 7.5, 10.104470257936567], [0, -0.20863176208185352, 0, 0.9779942678004921]], [[2, 15, 1], [94.43542233909116, 7.5, 18.843183003537035], [0, -0.38546097334782214, 0, 0.9227241397220242]], [[2, 15, 1], [85.33191384011477, 7.5, 25.23892547809613], [0, -0.5201626656263777, 0, 0.8540672112243047]], [[2, 15, 1], [74.84510059340936, 7.5, 28.960423271178374], [0, -0.6169606417522959, 0, 0.7869940066662486]], [[2, 15, 1], [64.47056059778917, 7.5, 30.367194803157066], [0, -0.6817095134448942, 0, 0.7316229488464162]], [[2, 15, 1], [55.34211023487832, 7.5, 30.339683878072442], [-0, -0.7156166443444858, 0, 0.6984932485981076]], [[2, 15, 1], [48.03730810240579, 7.5, 29.969157347776775], [-0, -0.7102524528868942, 0, 0.7039470528158707]], [[2, 15, 1], [42.58188961349901, 7.5, 30.225895271606745], [0, -0.6392358112215588, 0, 0.7690107786318183]], [[2, 15, 1], [38.61884499335278, 7.5, 31.719915503294366], [0, -0.48189617874830754, 0, 0.8762283223611179]], [[2, 15, 1], [35.651855264279575, 7.5, 34.62066764737223], [0, -0.32054777193604134, 0, 0.9472323505385781]], [[2, 15, 1], [33.25824629177569, 7.5, 38.73328891562966], [0, -0.22680471538818037, 0, 0.9739402553943883]]]
})

// one body - one mesh
const objects = [
    ...boxComposer.getObjects()
];

world.init(objects);

document.getElementById("btnBum").addEventListener("click", event => { 
    const force = 10000 * (1 + Math.random())
    const i = Math.trunc((world.objects.length - 1) * Math.random())
    world.objects[i].body.applyForce(new THREE.Vector3(0, 0, force))
});

// Animation loop
function animate() {
    world.update();
    requestAnimationFrame(animate);
}

animate();
